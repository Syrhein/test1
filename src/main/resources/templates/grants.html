<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ì •ë¶€ ì§€ì›ê¸ˆ ëª©ë¡</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/grant.css">
</head>
<body>

	<h1>ì •ë¶€ ì§€ì›ê¸ˆ ëª©ë¡</h1>

	<!-- ğŸ” ê²€ìƒ‰ ë° ì„¸ë¶€ í•„í„° -->
	<div class="filter-container">
		<input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">

		<!-- ğŸŒ ì§€ì—­ í•„í„° -->
		<select id="searchArea">
			<option value="ì „êµ­">ì „êµ­</option>
			<option value="ì„œìš¸">ì„œìš¸</option>
			<option value="ë¶€ì‚°">ë¶€ì‚°</option>
			<option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
			<option value="ì¸ì²œ">ì¸ì²œ</option>
			<option value="ê´‘ì£¼">ê´‘ì£¼</option>
			<option value="ëŒ€ì „">ëŒ€ì „</option>
			<option value="ìš¸ì‚°">ìš¸ì‚°</option>
			<option value="ì„¸ì¢…">ì„¸ì¢…</option>
			<option value="ê²½ê¸°">ê²½ê¸°</option>
			<option value="ê°•ì›">ê°•ì›</option>
			<option value="ì¶©ë¶">ì¶©ë¶</option>
			<option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
			<option value="ì „ë¶">ì „ë¶</option>
			<option value="ì „ë‚¨">ì „ë‚¨</option>
			<option value="ê²½ë¶">ê²½ë¶</option>
			<option value="ê²½ë‚¨">ê²½ë‚¨</option>
			<option value="ì œì£¼">ì œì£¼</option>
		</select>


		<!-- ğŸ“… ì‹ ì²­ ê¸°ê°„ í•„í„° -->
		<input type="date" id="startDate"> <input type="date"
			id="endDate">


		<!-- ğŸ” ê²€ìƒ‰ ë²„íŠ¼ -->
		<button id="searchBtn">ê²€ìƒ‰</button>
	</div>


	<!-- ğŸ”¹ ì§€ì›ê¸ˆ ëª©ë¡ ì¹´ë“œë·° -->
	<div class="card-container" id="grantList">
		<!-- JavaScriptì—ì„œ ì§€ì›ê¸ˆ ë°ì´í„°ê°€ ë™ì ìœ¼ë¡œ ì‚½ì…ë¨ -->
	</div>

	<!-- ğŸ”¢ í˜ì´ì§€ë„¤ì´ì…˜ -->
	<ul class="pagination" id="pagination"></ul>



	<!-- ì§€ì—­ ì½”ë“œ ë§¤í•‘ -->
	<script>
	const regionCodes = {
	    "":"00", "ì „êµ­": "00", "ì„œìš¸": "11", "ë¶€ì‚°": "21", "ëŒ€êµ¬": "22", "ì¸ì²œ": "23", "ê´‘ì£¼": "24", "ëŒ€ì „": "25", "ìš¸ì‚°": "26", "ì„¸ì¢…": "29", "ê²½ê¸°": "31", "ê°•ì›": "32", "ì¶©ë¶": "33", "ì¶©ë‚¨": "34", "ì „ë¶": "35", "ì „ë‚¨": "36", "ê²½ë¶": "37", "ê²½ë‚¨": "38", "ì œì£¼": "39"
	    	,"ê¸°ì¥" : "21" , "ë‹¬ì„±" : "22" , "ë‹¬ì„±" : "22" , "ê°•í™”" : "23" , "ì˜¹ì§„" : "23" , "ìš¸ì£¼" : "26" , "ìˆ˜ì›" : "31" , "ì„±ë‚¨" : "31" , "ì˜ì •ë¶€" : "31" , "ì•ˆì–‘" : "31" , "ë¶€ì²œ" : "31" , "ê´‘ëª…" : "31" , "í‰íƒ" : "31" , "ë™ë‘ì²œ" : "31" , "ì•ˆì‚°" : "31" , "ê³ ì–‘" : "31" , "ê³¼ì²œ" : "31" , "êµ¬ë¦¬" : "31" , "ë‚¨ì–‘ì£¼" : "31" , "ì˜¤ì‚°" : "31" , "ì‹œí¥" : "31" , "êµ°í¬" : "31" , "ì˜ì™•" : "31" , "í•˜ë‚¨" : "31" , "ìš©ì¸" : "31" , "íŒŒì£¼" : "31" , "ì´ì²œ" : "31" , "ì•ˆì„±" : "31" , "ê¹€í¬" : "31" , "í™”ì„±" : "31" , "ê´‘ì£¼" : "31" , "ì–‘ì£¼" : "31" , "í¬ì²œ" : "31" , "ì—¬ì£¼" : "31" , "ì—°ì²œ" : "31" , "ê°€í‰" : "31" , "ì–‘í‰" : "31" , "ì¶˜ì²œ" : "32" , "ì›ì£¼" : "32" , "ê°•ë¦‰" : "32" , "ë™í•´" : "32" , "íƒœë°±" : "32" , "ì†ì´ˆ" : "32" , "ì‚¼ì²™" : "32" , "í™ì²œ" : "32" , "íš¡ì„±" : "32" , "ì˜ì›”" : "32" , "í‰ì°½" : "32" , "ì •ì„ " : "32" , "ì² ì›" : "32" , "í™”ì²œ" : "32" , "ì–‘êµ¬" : "32" , "ì¸ì œ" : "32" , "ê³ ì„±" : "32" , "ì–‘ì–‘" : "32" , "ì²­ì£¼" : "33" , "ì¶©ì£¼" : "33" , "ì œì²œ" : "33" , "ë³´ì€" : "33" , "ì˜¥ì²œ" : "33" , "ì˜ë™" : "33" , "ì¦í‰" : "33" , "ì§„ì²œ" : "33" , "ê´´ì‚°" : "33" , "ìŒì„±" : "33" , "ë‹¨ì–‘" : "33" , "ì²œì•ˆ" : "34" , "ê³µì£¼" : "34" , "ë³´ë ¹" : "34" , "ì•„ì‚°" : "34" , "ì„œì‚°" : "34" , "ë…¼ì‚°" : "34" , "ê³„ë£¡" : "34" , "ë‹¹ì§„" : "34" , "ê¸ˆì‚°" : "34" , "ë¶€ì—¬" : "34" , "ì„œì²œ" : "34" , "ì²­ì–‘" : "34" , "í™ì„±" : "34" , "ì˜ˆì‚°" : "34" , "íƒœì•ˆ" : "34" , "ì „ì£¼" : "35" , "êµ°ì‚°" : "35" , "ìµì‚°" : "35" , "ì •ì" : "35" , "ë‚¨ì›" : "35" , "ê¹€ì œ" : "35" , "ì™„ì£¼" : "35" , "ì§„ì•ˆ" : "35" , "ë¬´ì£¼" : "35" , "ì¥ìˆ˜" : "35" , "ì„ì‹¤" : "35" , "ìˆœì°½" : "35" , "ê³ ì°½" : "35" , "ë¶€ì•ˆ" : "35" , "ëª©í¬" : "36" , "ì—¬ìˆ˜" : "36" , "ìˆœì²œ" : "36" , "ë‚˜ì£¼" : "36" , "ê´‘ì–‘" : "36" , "ë‹´ì–‘" : "36" , "ê³¡ì„±" : "36" , "êµ¬ë¡€" : "36" , "ê³ í¥" : "36" , "ë³´ì„±" : "36" , "í™”ìˆœ" : "36" , "ì¥í¥" : "36" , "ê°•ì§„" : "36" , "í•´ë‚¨" : "36" , "ì˜ì•”" : "36" , "ë¬´ì•ˆ" : "36" , "í•¨í‰" : "36" , "ì˜ê´‘" : "36" , "ì¥ì„±" : "36" , "ì™„ë„" : "36" , "ì§„ë„" : "36" , "ì‹ ì•ˆ" : "36" , "í¬í•­" : "37" , "ê²½ì£¼" : "37" , "ê¹€ì²œ" : "37" , "ì•ˆë™" : "37" , "êµ¬ë¯¸" : "37" , "ì˜ì£¼" : "37" , "ì˜ì²œ" : "37" , "ìƒì£¼" : "37" , "ë¬¸ê²½" : "37" , "ê²½ì‚°" : "37" , "êµ°ìœ„" : "37" , "ì˜ì„±" : "37" , "ì²­ì†¡" : "37" , "ì˜ì–‘" : "37" , "ì˜ë•" : "37" , "ì²­ë„" : "37" , "ê³ ë ¹" : "37" , "ì„±ì£¼" : "37" , "ì¹ ê³¡" : "37" , "ì˜ˆì²œ" : "37" , "ë´‰í™”" : "37" , "ìš¸ì§„" : "37" , "ìš¸ë¦‰" : "37" , "ì°½ì›" : "38" , "ì§„ì£¼" : "38" , "í†µì˜" : "38" , "ì‚¬ì²œ" : "38" , "ê¹€í•´" : "38" , "ë°€ì–‘" : "38" , "ê±°ì œ" : "38" , "ì–‘ì‚°" : "38" , "ì˜ë ¹" : "38" , "í•¨ì•ˆ" : "38" , "ì°½ë…•" : "38" , "ê³ ì„±" : "38" , "ë‚¨í•´" : "38" , "í•˜ë™" : "38" , "ì‚°ì²­" : "38" , "í•¨ì–‘" : "38" , "ê±°ì°½" : "38" , "í•©ì²œ" : "38" , "ì œì£¼" : "39" , "ì„œê·€í¬" : "39"};

</script>


	<!-- ìš”ì²­ URL ìƒì„± -->
	<script>
function buildApiUrl(page = 1) {
    let baseUrl = "https://apis.data.go.kr/1390000/youngV2/policyListV2";
    let params = [];

    // âœ… ê³ ì •ëœ í•„ìˆ˜ íŒŒë¼ë¯¸í„°
    params.push("typeDv=json");
    params.push("serviceKey=lwFN%2B9DgtdnDkUuQpxCaemhEBXNKBw%2FEIeII2WsOlInuroAHa9InabfXhyR365jieyuEEzrb2QYAHP3b3AlrFA%3D%3D");
    params.push(`rowCnt=${itemsPerPage}`);
    params.push(`cp=${page}`);

    // âœ… ë™ì  ì¶”ê°€ íŒŒë¼ë¯¸í„°
    let area = $("#searchArea").val();
    let keyword = $("#searchKeyword").val();
    let startDate = $("#startDate").val();
    let endDate = $("#endDate").val();
    let status = $("#searchStatus").val();
    let minPrice = $("#minPrice").val();
    let maxPrice = $("#maxPrice").val();
    let sortOrder = $("#sortOrder").val();

    if (keyword) params.push(`search_keyword=${encodeURIComponent(keyword)}`);

    // âœ… ì§€ì—­ ì„ íƒê°’ì„ ì§€ì—­ ì½”ë“œë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€
    if (area && regionCodes[area]) {
        params.push(`search_area1=${regionCodes[area]}`);
    }

    if (startDate) params.push(`sd=${startDate}`);
    if (endDate) params.push(`ed=${endDate}`);
    if (status) params.push(`search_status=${encodeURIComponent(status)}`);
    if (minPrice) params.push(`minPrice=${minPrice}`);
    if (maxPrice) params.push(`maxPrice=${maxPrice}`);
    if (sortOrder) params.push(`sort=${sortOrder}`);

    let finalUrl = `${baseUrl}?${params.join("&")}`;
    console.log("ğŸ“Œ API ìš”ì²­ URL:", finalUrl);

    return finalUrl;
}


</script>


	<!-- API í˜¸ì¶œ -->
	<script>
    let currentPage = 1; // í˜„ì¬ í˜ì´ì§€ ì €ì¥
    let itemsPerPage = 10; // í•œ í˜ì´ì§€ë‹¹ ê°œìˆ˜

    function fetchGrants(page = 1) {
        currentPage = page; // í˜„ì¬ í˜ì´ì§€ ì €ì¥
        let apiUrl = buildApiUrl(page); // âœ… ë™ì ìœ¼ë¡œ URL ìƒì„±

        $.ajax({
            url: apiUrl,
            type: "GET",
            dataType: "json",
            success: function(response) {
                console.log("ğŸ“Œ API ì‘ë‹µ ë°ì´í„°:", response);
                renderGrantList(response.policy_list);
                let totalItems = response.policy_paging?.totalCount || 0;
                let totalPages = Math.ceil(totalItems / itemsPerPage);
                renderPagination(totalPages, page);
            },
            error: function() {
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

</script>

	<!-- ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ -->
	<script>
function renderGrantList(grants) {
    let html = "";
    if (grants && grants.length > 0) {
        grants.forEach(function(grant) {
            let status = getStatus(grant.applEdDt); // âœ… ì§„í–‰ ìƒíƒœ ê³„ì‚°

            html += `
                <div class="card">
                    <h3>${grant.title || "ì œëª© ì—†ìŒ"}</h3>
                    <p><strong>ëŒ€ìƒ:</strong> ${grant.eduTarget || "ëŒ€ìƒ ì •ë³´ ì—†ìŒ"}</p>
                    <p><strong>ì‹ ì²­ ê¸°ê°„:</strong> ${grant.applStDt || "ê¸°ê°„ ì—†ìŒ"} ~ ${grant.applEdDt || "ê¸°ê°„ ì—†ìŒ"}</p>
                    <p><strong>ì§„í–‰ ìƒíƒœ:</strong> <span class="${status === 'ì§„í–‰ì¤‘' ? 'ongoing' : 'closed'}">${status}</span></p>
                    <p><a href="/grants/detail/${grant.seq}">ìƒì„¸ë³´ê¸°</a></p>
                </div>
            `;
        });
    } else {
        html = "<p>âš  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    }

    $("#grantList").html(html);
}

</script>

	<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
	<script>
    function renderPagination(totalPages, currentPage) {
        let paginationHtml = "";

        if (totalPages > 1) {
            // â® ì²« í˜ì´ì§€ ì´ë™ ë²„íŠ¼
            if (currentPage > 1) {
                paginationHtml += `<li onclick="changePage(1)">Â«</li>`;
            }

            // ğŸ”¢ í˜„ì¬ í˜ì´ì§€ ê¸°ì¤€ ì•ë’¤ 2ê°œ í˜ì´ì§€ë§Œ í‘œì‹œ
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) {
                    paginationHtml += `<li class="active">${i}</li>`;
                } else {
                    paginationHtml += `<li onclick="changePage(${i})">${i}</li>`;
                }
            }

            // â­ ë§ˆì§€ë§‰ í˜ì´ì§€ ì´ë™ ë²„íŠ¼
            if (currentPage < totalPages) {
                paginationHtml += `<li onclick="changePage(${totalPages})">Â»</li>`;
            }
        }

        $("#pagination").html(paginationHtml); // ê¸°ì¡´ í˜ì´ì§€ë„¤ì´ì…˜ ì œê±° í›„ ìƒˆë¡œ ë Œë”ë§
    }

    function changePage(page) {
        fetchGrants(page); // âœ… í˜ì´ì§€ ë³€ê²½ ì‹œ API í˜¸ì¶œ
    }
</script>

	<!-- ì§„í–‰,ë§ˆê° êµ¬ë¶„í•˜ê¸° -->
	<script>
	function getStatus(applEdDt) {
    let today = new Date();
    let endDate = new Date(applEdDt);

    if (!applEdDt || isNaN(endDate)) {
        return "ì •ë³´ ì—†ìŒ";
    }

    return today <= endDate ? "ì§„í–‰ì¤‘" : "ë§ˆê°";
}
</script>

	<!-- ì²« í˜ì´ì§€ ê¸°ë³¸ê°’ í˜¸ì¶œ -->
	<script>
$(document).ready(function() {
    $("#searchBtn").click(function() {
        fetchGrants(1); // âœ… ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ 1í˜ì´ì§€ë¶€í„° ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
    });

    $("#sortOrder").change(function() {
        fetchGrants(1); // âœ… ì •ë ¬ ë³€ê²½ ì‹œ ì²« í˜ì´ì§€ë¶€í„° ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
    });

    fetchGrants(1); // âœ… í˜ì´ì§€ ë¡œë”© ì‹œ ê¸°ë³¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
});

</script>








</body>
</html>
